<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>IDV Assignment 3 — Charts 6,7,8,9,11</title>
<script src="https://d3js.org/d3.v7.min.js"></script>
<style>
  :root{
    --bg:#eaf1f1; --card:#fff; --ink:#0f172a; --muted:#64748b;
    --primary:#2563eb; --accent:#7c3aed; --green:#128272; --amber:#f59e0b;
  }
  body{margin:0;background:var(--bg);font-family:system-ui,-apple-system,Segoe UI,Roboto,"PingFang SC","Microsoft YaHei",sans-serif}
  .wrap{max-width:1100px;margin:28px auto;padding:0 18px}
  h1{margin:0 0 8px 0}
  h2{margin:36px 0 10px 0}
  .card{background:var(--card);border-radius:14px;box-shadow:0 6px 20px rgba(0,0,0,.07);padding:20px}
  .note{color:var(--muted);margin:10px 0 0 4px}
  .legend text{font-size:13px;fill:#334155}
  .axis text{font-size:12px}
  .tip{pointer-events:none}
</style>
</head>
<body>
<div class="wrap">
  <h1>Assignment 3 — Charts 6, 7, 8, 9, 11 (D3.js)</h1>

  <!-- ===================== Chart 6 ===================== -->
  <h2>Chart 6 — Transformer-like Schematic</h2>
  <div id="chart6" class="card"></div>
  <p class="note">Notes — Boxes represent components; a subtle fade-in shows build order. Hover any box to highlight its pairing.</p>

  <!-- ===================== Chart 7 ===================== -->
  <h2>Chart 7 — Three-Set Venn</h2>
  <div id="chart7" class="card"></div>
  <p class="note">Notes — Three translucent sets (<i>Delete / Replace / Rewrite</i>). Circles grow in on load; hover dims the others so overlaps are easier to see.</p>

  <!-- ===================== Chart 8 ===================== -->
  <h2>Chart 8 — Cross-Validation Accuracy (simple bars)</h2>
  <div id="chart8" class="card"></div>
  <p class="note">Notes — Solid bars show current accuracy; dashed ghosts show baseline. Bars animate up; hover shows exact value label.</p>

  <!-- ===================== Chart 9 ===================== -->
  <h2>Chart 9 — Line Sketch (stroke animation)</h2>
  <div id="chart9" class="card"></div>
  <p class="note">Notes — A single SVG path mimics a “sketch line”. It draws itself with stroke-dash animation; click retraces.</p>

  <!-- ===================== Chart 11 ===================== -->
  <h2>Chart 11 — Two Distributions with Decision Band</h2>
  <div id="chart11" class="card"></div>
  <p class="note">Notes — Two Gaussian-like curves with a shaded decision band. Lines draw in; legend hover highlights a series.</p>

  <h2>Reflection / Summary</h2>
  <div class="card">
    <p>
      I replicated five chart types with D3 v7: a schematic (layout primitives), a Venn (overlapping shapes),
      a bar chart (scales/axes/joins), a stroke animation (path metrics), and functional curves (custom data + line
      generator). Each chart includes one reasonable transition and one small interaction to satisfy the assignment
      while keeping behavior meaningful (e.g., value tooltips, legend focus, highlight on hover). The main D3 concepts
      exercised are: data join (<code>selection.data().enter()</code>), scales (<code>scaleLinear/scaleBand</code>),
      shape generators (<code>d3.line</code>), axes, path metrics (<code>getTotalLength</code>) for animations, and basic
      event handlers. Styling is intentionally minimal and consistent for readability.
    </p>
  </div>
</div>

<script>
/* =============== Chart 6: schematic =============== */
(function(){
  const W=1000,H=360,pad=22;
  const svg=d3.select("#chart6").append("svg").attr("width",W).attr("height",H);
  svg.append("rect").attr("x",pad).attr("y",pad).attr("width",W-2*pad).attr("height",H-2*pad)
     .attr("rx",10).attr("fill","#f8fafc").attr("stroke","#cbd5e1");

  const left = [
    {y:80,  text:"Embedding"},
    {y:130, text:"Positional Encoding"},
    {y:180, text:"Multi-Head Attention"},
    {y:230, text:"Feed Forward"}
  ];
  const right = [
    {y:80,  text:"Masked Multi-Head Attention"},
    {y:130, text:"Encoder-Decoder Attention"},
    {y:180, text:"Feed Forward"},
    {y:230, text:"Classification Head"}
  ];

  function box(g,x,y,w,h,label,fill,stroke){
    const b=g.append("g").attr("transform",`translate(${x},${y})`).style("opacity",0);
    b.append("rect").attr("width",w).attr("height",h).attr("rx",8)
      .attr("fill",fill).attr("stroke",stroke);
    b.append("text").attr("x",w/2).attr("y",h/2+5).attr("text-anchor","middle")
      .style("font-weight",700).style("font-size","18px").text(label);
    b.transition().delay(y*2).duration(400).style("opacity",1);
    b.on("mouseenter",()=>b.select("rect").transition().duration(150).attr("stroke","#0ea5e9").attr("stroke-width",2.5))
     .on("mouseleave",()=>b.select("rect").transition().duration(150).attr("stroke",stroke).attr("stroke-width",1));
    return b;
  }
  const g=svg.append("g").attr("transform","translate(40,0)");
  left.forEach((d,i)=>box(g,110,d.y,240,42,"left", "#e2e8f0","#94a3b8").select("text").text(d.text));
  right.forEach((d,i)=>box(g,520,d.y,360,42,"right","#dcfce7","#86efac").select("text").text(d.text));

  // links
  left.forEach((d,i)=>{
    svg.append("line")
      .attr("x1", 110+240+40).attr("y1", d.y+pad+42/2)
      .attr("x2", 110+240+40).attr("y2", d.y+pad+42/2)
      .attr("stroke","#64748b").attr("stroke-width",2)
      .transition().delay(250+i*120).duration(500)
      .attr("x2", 520-10);
  });
})();

/* =============== Chart 7: Venn =============== */
(function(){
  const W=1000,H=520, cx1=370, cx2=630, cx3=520, cy=320, r=220;
  const svg=d3.select("#chart7").append("svg").attr("width",W).attr("height",H);
  const sets=[
    {cx:cx1, cy:cy, r:r, fill:"#fecaca", label:"Delete"},
    {cx:cx2, cy:cy, r:r, fill:"#bfdbfe", label:"Replace"},
    {cx:cx3, cy:cy+120, r:r, fill:"#bbf7d0", label:"Rewrite"}
  ];
  const g=svg.append("g");
  const cs=g.selectAll("circle").data(sets).enter().append("circle")
    .attr("cx",d=>d.cx).attr("cy",d=>d.cy).attr("r",0)
    .attr("fill",d=>d.fill).attr("opacity",0.6);
  cs.transition().duration(700).attr("r",d=>d.r);
  g.selectAll("text").data(sets).enter().append("text")
    .attr("x",d=>d.cx).attr("y",d=>d.cy-d.r+28).attr("text-anchor","middle")
    .style("font-size","20px").text(d=>d.label).style("opacity",0)
    .transition().delay(400).duration(500).style("opacity",1);
  // focus interaction
  cs.on("mouseenter",(_,d)=>{
      cs.filter(x=>x!==d).transition().duration(150).style("opacity",0.25);
    })
    .on("mouseleave",()=>cs.transition().duration(150).style("opacity",0.6));
})();

/* =============== Chart 8: Bars with ghost baseline =============== */
(function(){
  const data=[
    {model:"BERT", acc:74.4, base:64.8},
    {model:"RoBERTa", acc:81.9, base:65.5},
    {model:"BART", acc:73.1, base:63.5}
  ];
  const W=960,H=380,m={t:22,r:30,b:70,l:60};
  const svg=d3.select("#chart8").append("svg").attr("width",W).attr("height",H);
  const x=d3.scaleBand().domain(data.map(d=>d.model)).range([m.l,W-m.r]).padding(0.3);
  const y=d3.scaleLinear().domain([60,100]).nice().range([H-m.b,m.t]);
  svg.append("g").attr("transform",`translate(0,${H-m.b})`).attr("class","axis").call(d3.axisBottom(x));
  svg.append("g").attr("transform",`translate(${m.l},0)`).attr("class","axis").call(d3.axisLeft(y).ticks(6));

  // dashed ghosts (baseline)
  svg.selectAll(".ghost").data(data).enter().append("rect").attr("class","ghost")
    .attr("x",d=>x(d.model)+x.bandwidth()/2-24).attr("width",48)
    .attr("y",y(60)).attr("height",0)
    .attr("fill","none").attr("stroke","#d4d4d4").attr("stroke-dasharray","6 6")
    .transition().duration(700).attr("y",d=>y(d.base)).attr("height",d=>y(60)-y(d.base));

  // main bars
  const bars=svg.selectAll(".bar").data(data).enter().append("rect").attr("class","bar")
    .attr("x",d=>x(d.model)).attr("width",x.bandwidth())
    .attr("y",y(60)).attr("height",0).attr("fill","#4375ff");
  bars.transition().delay((_,i)=>150+i*200).duration(800)
    .attr("y",d=>y(d.acc)).attr("height",d=>y(60)-y(d.acc));

  // value label on hover
  bars.on("mousemove",function(e,d){
    const [mx,my]=d3.pointer(e,this);
    svg.selectAll(".tip").data([d]).join("text").attr("class","tip")
      .attr("x", x(d.model)+x.bandwidth()/2).attr("y", y(d.acc)-8)
      .attr("text-anchor","middle").style("font-weight",700).text(d.acc.toFixed(1));
  }).on("mouseleave",()=>svg.selectAll(".tip").remove());
})();

/* =============== Chart 9: Sketch line =============== */
(function(){
  const W=1000,H=320, pad=20;
  const svg=d3.select("#chart9").append("svg").attr("width",W).attr("height",H);
  const path = svg.append("path")
    .attr("d","M 80 220 C 260 60, 560 120, 760 240 S 940 300, 930 260")
    .attr("fill","none").attr("stroke", "#8b5cf6").attr("stroke-width",6)
    .attr("stroke-linecap","round");

  function draw(){
    const L = path.node().getTotalLength();
    path.attr("stroke-dasharray", `${L} ${L}`).attr("stroke-dashoffset", L)
      .transition().duration(1200).ease(d3.easeCubicInOut).attr("stroke-dashoffset", 0);
  }
  draw();
  svg.on("click", draw);
})();

/* =============== Chart 11: two curves + decision band =============== */
(function(){
  const W=1000,H=420,m={t:20,r:20,b:50,l:60};
  const svg=d3.select("#chart11").append("svg").attr("width",W).attr("height",H);
  const x=d3.scaleLinear().domain([-2,5]).range([m.l,W-m.r]);
  const y=d3.scaleLinear().domain([0,0.35]).range([H-m.b,m.t]);

  // axes + grid
  svg.append("g").attr("transform",`translate(0,${H-m.b})`).call(d3.axisBottom(x).ticks(8));
  svg.append("g").attr("transform",`translate(${m.l},0)`).call(d3.axisLeft(y).ticks(6));
  svg.selectAll(".grid").data(d3.range(8)).enter().append("line")
     .attr("x1",d=>x(d-2)).attr("x2",d=>x(d-2)).attr("y1",m.t).attr("y2",H-m.b)
     .attr("stroke","#e5e7eb");

  // gaussians
  function gaussian(mu,sig){
    return d3.range(-2,5.01,0.03).map(x=>({x, y: (1/(sig*Math.sqrt(2*Math.PI)))*Math.exp(-0.5*((x-mu)/sig)**2)}));
  }
  const A=gaussian(0.2,0.7), B=gaussian(2.0,0.7);
  const line=d3.line().x(d=>x(d.x)).y(d=>y(d.y));

  // decision band
  const t1=0.9,t2=1.4;
  svg.append("rect").attr("x",x(t1)).attr("y",y(0.33))
     .attr("width",x(t2)-x(t1)).attr("height",y(0)-y(0.33))
     .attr("fill","#9ca3af").attr("opacity",.35);

  function drawPath(data,color,cls){
    const p=svg.append("path").attr("class",cls).attr("fill","none").attr("stroke",color).attr("stroke-width",3)
               .attr("d",line(data));
    const L=p.node().getTotalLength();
    p.attr("stroke-dasharray", `${L} ${L}`).attr("stroke-dashoffset", L)
     .transition().duration(1200).ease(d3.easeCubicInOut).attr("stroke-dashoffset",0);
    return p;
  }
  const pA=drawPath(A,"#f59e0b","A"), pB=drawPath(B,"#0ea5e9","B");

  // legend interaction
  const legend=svg.append("g").attr("transform",`translate(${W-280},${m.t+8})`).attr("class","legend");
  legend.append("line").attr("x1",0).attr("x2",22).attr("y1",0).attr("y2",0).attr("stroke","#f59e0b").attr("stroke-width",3);
  legend.append("text").attr("x",28).attr("y",4).text("p(x, y=0)·v(x)");
  legend.append("line").attr("x1",140).attr("x2",162).attr("y1",0).attr("y2",0).attr("stroke","#0ea5e9").attr("stroke-width",3);
  legend.append("text").attr("x",168).attr("y",4).text("p(x, y=1)·v(x)");
  legend.selectAll("line,text").style("cursor","pointer");
  legend.on("mouseenter",()=>{ pA.attr("stroke-width",4); pB.attr("stroke-width",4); })
        .on("mouseleave",()=>{ pA.attr("stroke-width",3); pB.attr("stroke-width",3); });
})();
</script>
</body>
</html>
